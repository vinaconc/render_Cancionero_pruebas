\documentclass[a4paper,twoside,openany]{book}

% --- Codificación e idioma ---
\usepackage[utf8]{inputenc}
\usepackage[spanish]{babel}

% --- Paquetes generales ---
\usepackage{xcolor}
\usepackage[chorded]{songs}

% --- Paquetes adicionales ---
\usepackage{pdfpages}
\usepackage[normalem]{ulem}
\usepackage{scrextend}

% --- Geometría ---
\usepackage[a4paper,
            top=1cm, 
            bottom=2cm, 
            left=2.5cm, 
            right=1cm, 
            headheight=1.5cm,
            headsep=1cm,
            footskip=1.5cm,
            textwidth=16.5cm,
            textheight=23.42cm,
            showframe=false
            ]{geometry}

% --- Índices ---
\usepackage{imakeidx}
\makeindex[name=tema, title=Índice Temático]
\makeindex[name=titleidx, title=Índice Alfabético de Canciones, columns=1] 

\newcommand{\indexsongtitle}[1]{%
  \phantomsection
  \index[titleidx]{#1}%
}

% --- Hipervínculos ---
\usepackage{hyperref} 
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    citecolor=green,
    urlcolor=cyan,
    filecolor=magenta,
    pdftitle={Mi Cancionero Temático},
    pdfauthor={Tu Nombre},
    pdfcreator={LaTeX with hyperref},
    pdfproducer={LaTeX},
    linktocpage=true
}

% --- Tamaño de fuente ---
\changefontsizes[14pt]{11pt} 

% --- Configuraciones del paquete 'songs' ---
\noversenumbers
\baselineadj=-10pt plus 10pt minus 10pt
\renewcommand{\clineparams}{
  \baselineskip=35pt
  \lineskiplimit=35pt
  \lineskip=1pt
}

% --- Redefinir estrofas para letra al margen ---
\makeatletter
\renewcommand{\printverse}[1]{%
  \begingroup
  \setlength{\parindent}{0pt}%
  \setlength{\leftskip}{0pt}%
  \setlength{\parskip}{0.5em}%
  \@for\verse@line:=#1\do{%
    \ifx\verse@line\empty\else
      \noindent
      \llap{\textbf{\verse@num}\hspace{1em}}%
      \verse@line\par
    \fi
  }%
  \endgroup
}
\makeatother

% --- Resto de comandos personalizados ---
\newcommand{\version}{}
\newsongkey{v}{\def\version{}}{\def\version{Versión: #1\par}}

\newcommand\toctitle{}
\makeatletter
\gdef\toclink{%
  \@ifundefined{href}{}%
}
\makeatother

\newcommand\addtotoc[1]{\addtocontents{toc}{\protect\contentsline
 {\ifnum\value{section}>0sub\fi section}%
{\numberline\thesongnum#1}%
 {\thepage}%
 {\toclink}}}
\newsongkey{toc}{\def\toctitle{\resettitles\addtotoc\songtitle}}{\def\toctitle{\addtotoc{#1}}}
\renewcommand{\extendprelude}{\showrefs\showauthors\toctitle {\bfseries\version}}

\newcommand{\indexword}[1]{\textcolor{blue}{#1}\index{#1}}

\let\cleardoublepage\relax

\begin{document}

\frontmatter
\tableofcontents{\thispagestyle{empty}}
\clearpage

\mainmatter
\pagestyle{plain}

\renewcommand{\indexname}{Índice Temático}
\renewcommand{\everychorus}{\textnote{CORO:}}
\renewcommand{\chorusfont}{\it}
\renewcommand{\printchord}[1]{\rmfamily\bf#1}
% Desactiva el recuadro automático de estrofas
\setlength{\versesep}{1em}   % separación entre estrofas
\renewcommand{\printverse}[1]{%
  \begingroup
  \setlength{\parindent}{0pt}%
  \setlength{\parskip}{0.5em}%
  \@for\verse@line:=#1\do{%
    \ifx\verse@line\empty\else
      \noindent
      \llap{\textbf{\verse@num}\hspace{1em}}%
      \verse@line\par
    \fi
  }%
  \endgroup
}

% --- INICIO CANCIONERO ---
% --- FIN CANCIONERO ---

\printindex[titleidx]
\end{document}

